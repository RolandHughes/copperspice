Name:       @PACKAGE@
Version:    @RPM_VERSION@
Release:    @RPM_RELEASE@
Summary:    @CPACK_PACKAGE_DESCRIPTION_SUMMARY@
License:    GPL V2 + restriction
Group:      Development/Libraries/C and C++
URL:        https://github.com/RolandHughes/copperspice
Vendor:     @CPACK_PACKAGE_VENDOR@
Packager:   Roland Hughes <roland@logikalsolutions.com>


%description
@CPACK_PACKAGE_DESCRIPTION_TEXT@

%prep
# Cleanup any left over build files
#
rm -rf *

# Populate the build directory

cmake -G "Ninja" -DCMAKE_BUILD_TYPE=Release \
      -DCMAKE_SKIP_BUILD_RPATH=TRUE \
      -DBUILDING_RPM=ON \
      -DCMAKE_INSTALL_PREFIX="%{buildroot}/usr" \
      "@CMAKE_SOURCE_DIR@"

%package devel
Summary: Development files for @CPACK_PACKAGE_DESCRIPTION_SUMMARY@

%description devel
Development files for
@CPACK_PACKAGE_DESCRIPTION_TEXT@

%build
ninja

%install
# This variable gets rid of bogus RPATH error message
#
# The default CopperSpice build has .. in RPATH for lconvert and other binaries.
# This QA_RPATHS variable is a bitmask override for certain checks.
#
# TODO:: See if we cannot completely remove $ORIGIN for BUILDING_RPM
#        Should be able to 
#
QA_RPATHS=\$[0x0023]

ninja install


%files
/usr
%exclude %{_libdir}/cmake
%exclude %{_libdir}/pkgconfig
%exclude %{_libdir}/copperspice/bin
%exclude /usr/include
%exclude /usr/lib/.build-id

%files devel
/usr

%post

ldconfig


%postun
# No difference between upgrade and uninstall for these
#
# We did not do anything kinky like create links or files for ldconfig to consume
# May have to force an entry in $PATH but unknown right now. cmake files should already look there

%changelog
# let's skip this for now
